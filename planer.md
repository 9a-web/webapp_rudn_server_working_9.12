# План разработки модуля "Планировщик" (Planner)

Модуль "Планировщик" преобразует статичное расписание в интерактивный таймлайн дня, позволяя пользователю управлять своим временем, комбинируя учебные пары с личными задачами и событиями.

## Этап 1: Бэкенд (Backend)

### 1.1. Обновление моделей данных (`backend/models.py`)
- [ ] Расширить модель `Task` (или создать `TaskEvent`):
    - `is_fixed` (bool): Флаг "жесткого" события (например, пара).
    - `time_start` (str/datetime): Время начала (для событий на день).
    - `time_end` (str/datetime): Время окончания.
    - `origin` (str): Источник ('user', 'schedule', 'todo').
    - `schedule_event_id` (str): Ссылка на оригинальную пару (чтобы избежать дублей).

### 1.2. API Эндпоинты (`backend/server.py`)
- [ ] **POST /api/planner/sync**: Синхронизация расписания на день.
    - Принимает дату и `telegram_id`.
    - Получает расписание из `schedule_cache` (или парсит).
    - Создает/обновляет `Task` записи для каждой пары.
    - Возвращает список созданных событий.
- [ ] **POST /api/planner/event**: Создание пользовательского события.
    - Аналог создания задачи, но с обязательными `time_start` и `time_end`.
- [ ] **GET /api/planner/{date}**: Получение всех событий дня.
    - Возвращает смешанный список: реальные `Task` (с временем) + (опционально) "призрачные" пары, если они еще не добавлены. *Решение: Пока возвращаем только Task, фронтенд сам мержит с кэшом расписания для "призраков".*

## Этап 2: Фронтенд - Логика и API (`frontend/src/services`)

### 2.1. Обновление API сервиса (`api.js`)
- [ ] Добавить методы:
    - `plannerAPI.syncSchedule(date)`
    - `plannerAPI.createEvent(eventData)`

### 2.2. Логика синхронизации (Frontend Logic)
- [ ] В `TasksSection.jsx`:
    - Функция `handleSyncSchedule`: вызывает API, обновляет список задач.
    - Логика мержинга: При отображении "Распорядка дня", показывать:
        1. Задачи из БД с `target_date` == selectedDate.
        2. Пары из `scheduleForDate`, КОТОРЫХ НЕТ в задачах (по `schedule_event_id` или совпадению времени/названия). Они отображаются полупрозрачными.

## Этап 3: Фронтенд - UI Компоненты

### 3.1. Модальное окно создания события (`CreateEventModal.jsx`)
- [ ] Поля: Название, Время начала, Время конца, Категория, Описание.
- [ ] Валидация времени.

### 3.2. Обновление карточки события (`TaskItem` / New `EventCard`)
- [ ] Визуальное отличие "События" (есть время) от "Задачи" (чекбокс).
- [ ] Стили для "Призрачных" пар (кнопка "Добавить в план").
- [ ] Стили для "Реальных" пар (кнопка "Редактировать", "Удалить").

### 3.3. Интеграция в `TasksSection.jsx`
- [ ] Подключить кнопку "+" к `CreateEventModal`.
- [ ] Подключить кнопку "Синхронизация" к логике импорта.
- [ ] Обновить рендер списка в режиме `activeView === 'schedule'`.

## Этап 4: Тестирование и Полировка
- [ ] Проверка конфликтов времени (наложение событий).
- [ ] Тест удаления пары из плана (пара должна снова стать "призрачной" или исчезнуть, если мы хотим скрыть прогул).
- [ ] Проверка сохранения оффлайн (если применимо, но пока работаем с API).
